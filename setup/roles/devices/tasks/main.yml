---

- name: GA | Devices | Installing packages
  ansible.builtin.apt:
    name: "{{ ga_device_packages }}"
    state: present

- name: GA | Devices | Install python modules into venv
  ansible.builtin.pip:
    name: "{{ ga_device_mods }}"
    virtualenv: "{{ ga_core_path_venv }}"
    virtualenv_python: "{{ ga_python_version }}"
    state: present

- name: GA | Core | Copying device-code
  ansible.builtin.shell: "cp -r {{ setup_clone_dir }}/code/device {{ ga_core_path }} &&
  chown -R {{ ga_core_service_user }}:{{ ga_service_group }} {{ ga_core_path }}/device &&
  chmod 775 -R {{ ga_core_path }}/device"

- name: GA | Devices | Adding service user to groups
  ansible.builtin.user:
    name: "{{ ga_core_service_user }}"
    groups: "{{ ga_device_groups }}"
    append: yes

- name: GA | Devices | Configuring raspi-config
  ansible.builtin.shell: "raspi-config {{ item }}"
  with_items: "{{ ga_device_raspiconfig }}"
  ignore_errors: true
